<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/utilities.css" />
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <title>Book Now</title>
  </head>

  <body>
    <!--Navbar-->
    <section class="display-navbar">
      <div id="nav-placeholder"></div>
    </section>
    <!--Book Now-->
    <section class="book-header">
      <!--<h1>Book with us!</h1>-->
      <div class="check-availability">
        <form action="javascript:bookNow()" class="checkavail-form">
          <div class="form-item check-flex-item">
            <i class="icon material-symbols-outlined">event_upcoming</i>
            <label>Check in</label>
            <input class="select-date" id="checkin-date" placeholder="select a date" />
          </div>
          <div class="form-item check-flex-item">
            <i class="icon material-symbols-outlined">event_busy</i>
            <label>Check out</label>
            <input id="checkout-date" class="select-date" placeholder="select a date" />
          </div>
          <div class="form-item check-flex-item-m">
            <i class="icon material-symbols-outlined">groups</i>
            <label>Guests</label>
            <input
              class="guest"
              type="number"
              placeholder="1"
              pattern="[0-9]*"
              id="spinner"
              name="value"
              value="1"
              min="1"
              max="100"
              step="1"
              oninput="maxLengthCheck(this)"
              maxlength="2"
              required
            />
          </div>
          <div class="form-item check-flex-item-sm">
            <div class="search-icon">
              <button type="submit">
                <span class="icon"><i class="material-symbols-rounded"> search </i></span>
                <span class="text">CHECK AVAILABILITY</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <div class="booknow section-stroke">
      <img src="images/brush-stroke.png" />
    </div>

    <!--Available Rooms-->
    <section class="available-rooms">
      <div id="table_villas"></div>
      <!-- <div class="blog-card">
        <div class="room-pic">
          <div class="photo" style="background-image: url(images/casa_aurelia.JPG)"></div>
        </div>
        <div class="room-desc">
          <h1>
            Casa Aurelia<span class="room-price"><h1><span>&#8369;</span> 25,000.00</h1></span>
          </h1>
          <h2>
            <i class="material-symbols-rounded">person</i>Good for 10 guests
            <span class="per-night"><h2>per night</h2></span>
          </h2>

          <div class="room-links">
            <a href="#" class="read-more">More about Casa Aurelia >>></a>
            <span class="reserve-btn">
              <div class="book-btn bounce-in-on-hover">
                <a class="book-btn" href="#">RESERVE</a>
              </div>
            </span>
          </div>
        </div>
      </div> -->

      <!-- <div class="blog-card">
        <div class="room-pic">
          <div class="photo" style="background-image: url(images/casa_salud.JPG)"></div>
        </div>
        <div class="room-desc">
          <h1>
            Casa Salud<span class="room-price"
              ><h1><span>&#8369;</span> 18,500.00</h1></span
            >
          </h1>
          <h2>
            <i class="material-symbols-rounded">person</i>Good for 8 guests
            <span class="per-night"><h2>per night</h2></span>
          </h2>

          <div class="room-links">
            <a href="#" class="read-more">More about Casa Salud >>></a>
            <span class="reserve-btn">
              <div class="book-btn bounce-in-on-hover">
                <a class="book-btn" href="#">RESERVE</a>
              </div>
            </span>
          </div>
        </div>
      </div> -->

      <!-- <div class="blog-card">
        <div class="room-pic">
          <div class="photo" style="background-image: url(images/PRIMA1.JPG)"></div>
        </div>
        <div class="room-desc">
          <h1>
            Caminos de Primavera<span class="room-price"
              ><h1><span>&#8369;</span> 35,000.00</h1></span
            >
          </h1>
          <h2>
            <i class="material-symbols-rounded">person</i>Good for 20 guests
            <span class="per-night"><h2>per night</h2></span>
          </h2>

          <div class="room-links">
            <a href="#" class="read-more">More about Caminos de Primavera >>></a>
            <span class="reserve-btn">
              <div class="book-btn bounce-in-on-hover">
                <a class="book-btn" href="#">RESERVE</a>
              </div>
            </span>
          </div>
        </div>
      </div> -->
    </section>
    <!--Footer-->
    <section class="display-footer">
      <div id="footer-placeholder"></div>
    </section>
    <script src="app.js"></script>
    <script>
      //Import Navbar
      $(function () {
        $("#nav-placeholder").load("navbar.html");
      });
      //Import Footer
      $(function () {
        $("#footer-placeholder").load("footer.html");
      });
      //Date Picker
      let startDate = new Date();
      let endDate = new Date();
      // endDate.setDate(endDate.getDate() + 1);

      const picker = new Litepicker({
        element: document.getElementById("checkin-date"),
        elementEnd: document.getElementById("checkout-date"),
        numberOfMonths: 2,
        numberOfColumns: 2,
        singleMode: false,
        numberOfMonths: 2,
        allowRepick: true,
        minDays: 1, // Sets the min amount of days to 1
        maxDays: 730, // Sets the min amount of days to 1
        format: "D MMM, YYYY", // Format date
        minDate: startDate, //It will not allow to select past days
      });
      //Input Number
      function spinner() {
        // Spinner
        $("#spinner").spinner();

        //Input only numbers
        $("#spinner").keyup(function () {
          this.value = this.value.replace(/[^0-9]/g, "");
        });
      }
      //Input max number
      function maxLengthCheck(object) {
        if (object.value.length > object.maxLength) object.value = object.value.slice(0, object.maxLength);
      }
      window.onload = spinner;

      const getDate = () => {
        document.getElementById("checkin-date").value = sessionStorage.getItem("checkinDate");
        document.getElementById("checkout-date").value = sessionStorage.getItem("checkoutDate");
        document.getElementById("spinner").value = sessionStorage.getItem("guest");
      };

      getDate();

      const bookNow = () => {
        let checkinDate = document.getElementById("checkin-date").value;
        if (!checkinDate) {
          checkinDate = new Date();
          // sessionStorage.setItem("checkinDate2", checkinDate);
          document.getElementById("checkin-date").value = convertDate(checkinDate);
        }

        let checkoutDate = document.getElementById("checkout-date").value;
        if (!checkoutDate) {
          checkoutDate = new Date();
          // sessionStorage.setItem("checkoutDate2", checkoutDate);
          document.getElementById("checkout-date").value = convertDate(checkoutDate);
        }
        const checkin = new Date(checkinDate).toISOString();
        console.log(checkin);
        const checkout = new Date(checkoutDate).toISOString();
        const guest = document.getElementById("spinner").value;
        // sessionStorage.setItem("checkinDateFormat", checkin);
        // sessionStorage.setItem("checkoutDateFormat", checkout);
        sessionStorage.setItem("guestAmt", guest);
        console.log(checkin);
        console.log(checkout);
        console.log(guest);
        // console.log(sessionStorage.getItem("guestAmt"));
        const checkinval = document.getElementById("checkin-date").value;
        const checkoutval = document.getElementById("checkout-date").value;
        sessionStorage.setItem("checkinDate1", checkinval);
        sessionStorage.setItem("checkoutDate1", checkoutval);
        let options = {
          method: "GET",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
            Authorization: "Bearer " + localStorage.getItem("access_token"),
          },
        };
        console.log(`https://ulayaw-backend.herokuapp.com/villa/getAvailable?startDate=${checkin}&endDate=${checkout}&guests=${guest}`);
        fetch(`https://ulayaw-backend.herokuapp.com/villa/getAvailable?startDate=${checkin}&endDate=${checkout}&guests=${guest}`)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // console.log(data.villas[0]);
            // console.log(data.villas.length);
            // data.villas.forEach((villa) => {

            if (data.villas == "Casa Salud") {
            }

            if (checkinval === checkoutval) {
              if (data.villas.length > 0) {
                // const list = document.getElementById("table_villas");
                var data1 = "";
                let img;
                let section;
                for (i = 0; i < data.villas.length; i++) {
                  switch (data.villas[i].name) {
                    case "Casa Aurelia":
                      img = "casa_aurelia";
                      section = 1;
                      break;
                    case "Caminos De Primavera":
                      img = "PRIMA1";
                      section = 2;
                      break;
                    case "Casa Salud":
                      img = "casa_salud";
                      section = 3;
                      break;
                    case "Kubo ni Basyong":
                      img = "kubo1";
                      section = 4;
                      break;
                    case "Celso Tagle Hall":
                      img = "CELSO1";
                      section = 5;
                      break;
                  }
                  data1 += "<div class='blog-card'>";
                  data1 += "<div class='room-pic'>";
                  data1 += "<div class='photo' style='background-image: url(images/" + img + ".JPG)'></div></div>";
                  data1 += "<div class='room-desc'>";
                  data1 +=
                    "<h1>" +
                    data.villas[i].name +
                    "<span class='room-price'><h1><span>&#8369;</span>" +
                    data.villas[i].dayTour.price +
                    "</h1></span></h1>";
                  data1 += "<h2>";
                  data1 += "<i class='material-symbols-rounded'>person</i>Good for " + data.villas[i].dayTour.minPerson + " guests";
                  data1 += "<span class='per-night'><h2>Day Tour</h2></span></h2>";
                  data1 += "<div class='room-links'>";
                  data1 += "<a href='villa.html#section" + section + "' class='read-more'>More about " + data.villas[i].name + " >>></a>";
                  data1 += "<span class='reserve-btn'>";
                  data1 += "<div class='book-btn bounce-in-on-hover'>";
                  data1 += "<a class='" + data.villas[i]._id + " book-btn' href='#'>RESERVE</a>";
                  data1 += "</div>";
                  data1 += "</span>";
                  data1 += "</div>";
                  data1 += "</div>";
                  data1 += "</div>";
                }
                $("#table_villas").html(data1);
              } else {
                data1 = "<div class='no-results'> <h2>No Villas Available</h2> <p>Select another date to reserve.</p> </div>";
                $("#table_villas").html(data1);
              }
              // });
            } else {
              if (data.villas.length > 0) {
                // const list = document.getElementById("table_villas");
                var data1 = "";
                let img;
                let section;
                data.villas = data.villas.filter((obj) => obj.overnight.price !== 0);
                for (i = 0; i < data.villas.length; i++) {
                  switch (data.villas[i].name) {
                    case "Casa Aurelia":
                      img = "casa_aurelia";
                      section = 1;
                      break;
                    case "Caminos De Primavera":
                      img = "PRIMA1";
                      section = 2;
                      break;
                    case "Casa Salud":
                      img = "casa_salud";
                      section = 3;
                      break;
                    case "Kubo ni Basyong":
                      img = "kubo1";
                      section = 4;
                      break;
                    case "Celso Tagle Hall":
                      img = "CELSO1";
                      section = 5;
                      break;
                  }
                  data1 += "<div class='blog-card'>";
                  data1 += "<div class='room-pic'>";
                  data1 += "<div class='photo' style='background-image: url(images/" + img + ".JPG)'></div></div>";
                  data1 += "<div class='room-desc'>";
                  data1 +=
                    "<h1>" +
                    data.villas[i].name +
                    "<span class='room-price'><h1><span>&#8369;</span>" +
                    data.villas[i].overnight.price +
                    "</h1></span></h1>";
                  data1 += "<h2>";
                  data1 += "<i class='material-symbols-rounded'>person</i>Good for " + data.villas[i].overnight.minPerson + " guests";
                  data1 += "<span class='per-night'><h2>per night</h2></span></h2>";
                  data1 += "<div class='room-links'>";
                  data1 += "<a href='villa.html#section" + section + "' class='read-more'>More about " + data.villas[i].name + " >>></a>";
                  data1 += "<span class='reserve-btn'>";
                  data1 += "<div class='book-btn bounce-in-on-hover'>";
                  data1 += "<a class='" + data.villas[i]._id + " book-btn' href='#'>RESERVE</a>";
                  data1 += "</div>";
                  data1 += "</span>";
                  data1 += "</div>";
                  data1 += "</div>";
                  data1 += "</div>";
                }
                $("#table_villas").html(data1);
              } else {
                data1 = "<div class='no-results'> <h2>No Villas Available</h2> <p>Select another date to reserve.</p> </div>";
                $("#table_villas").html(data1);
              }
              // });
            }
          });
      };
      bookNow();

      const saveId = (e) => {
        // console.log(e);
        if (e.target.classList[1] === "book-btn") {
          let id = e.target.classList[0];
          console.log(id);
          sessionStorage.setItem("villa_id", id);
          window.location.replace("/reservationdetails.html");
        }
      };
      document.body.addEventListener("click", saveId);
    </script>
  </body>
</html>
