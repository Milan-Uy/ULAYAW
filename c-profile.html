<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/utilities.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link href="https://fonts.googleapis.com/css?family=Cinzel" rel="stylesheet" />

    <title>Profile</title>
  </head>
  <body>
    <!--Navbar-->
    <section class="display-navbar">
      <div id="nav-placeholder"></div>
    </section>
    <!--Profile-->
    <section class="sidebar-tabs">
      <div class="sidebar container">
        <!--Sidebar-->
        <div class="tabs-wrapper">
          <ul class="tabs">
            <!--List of Tabs-->
            <li class="tab-active" rel="tabОne">
              <i class="material-symbols-rounded">person </i>
              <span class="label">Profile</span>
            </li>
            <li rel="tabTwo">
              <i class="material-symbols-rounded">event_available</i>
              <span class="label">Booking Status</span>
            </li>
            <li rel="tabThree">
              <i class="material-symbols-rounded">photo_library</i>
              <span class="label">Upload a Moment</span>
            </li>
            <li rel="tabFour">
              <i class="material-symbols-rounded">rate_review</i>
              <span class="label">Customer Satisfaction</span>
            </li>
            <li rel="tabFive" onclick="logout()">
              <i class="material-symbols-rounded">logout</i>
              <span class="label">Logout</span>
            </li>
          </ul>
          <div class="tabs-container">
            <!--Profile Tab-->
            <h4 class="tab-accordion-active tab-accordion-title" rel="tabОne">Profile</h4>
            <div id="tabОne" class="tab-item">
              <h5 id="nameTag">Welcome, Unknown User</h5>
              <!-- ALERT -->
              <div class="alertMessage alert3">
                <span class="close" id="close-alert3">×</span>
                <i class="fas fa-exclamation-circle alert-icon"></i>
                <strong>Profile was successfully updated!</strong>
              </div>
              <div class="edit-container">
                <div class="user-details">
                  <h5>User Details</h5>
                  <button class="editprofile-btn" id="removeReadOnly">Edit Profile</button>
                </div>
                <div class="form-box">
                  <form action="javascript:saveProfile();" class="edit-form">
                    <div class="form-container">
                      <div class="col-6 hide-txt1 hide-text-bg">
                        <label>First Name</label>
                        <input type="text" id="firstname" placeholder="First Name" readonly />
                      </div>
                      <div class="col-6 hide-txt2 hide-text-bg">
                        <label>Last Name</label>
                        <input id="lastname" type="text" placeholder="Last Name" readonly />
                      </div>
                    </div>
                    <div class="form-container">
                      <div class="col-3 hide-txt3 hide-text-bg">
                        <label>Contact Number</label>
                        <input
                          type="tel"
                          id="contact"
                          placeholder="Contact Number"
                          maxlength="11"
                          minxlength="11"
                          value=""
                          pattern="[0]{1}[9]{1}[0-9]{2}[0-9]{3}[0-9]{4}"
                          oninput="this.value = this.value.replace(/[^0-9+()]/g, '');"
                          readonly
                        />
                      </div>
                    </div>
                    <div class="form-container">
                      <div class="col-3 hide-txt4 hide-text-bg">
                        <label>Email Address</label>
                        <input type="email" id="email" placeholder="Email Address" readonly />
                      </div>
                    </div>
                    <div class="flex-end-container">
                      <button type="submit" class="saveProfile-btn" id="saveProfile-btn">Save Changes</button>
                    </div>
                  </form>
                </div>
              </div>
              <!-- ALERT -->
              <div class="alertMessage alert4">
                <span class="close" id="close-alert4">×</span>
                <i class="fas fa-exclamation-circle alert-icon"></i>
                <strong>Password was successfully updated!</strong>
              </div>
              <div class="alertMessage alert5">
                <span class="close" id="close-alert5">×</span>
                <i class="fas fa-exclamation-circle alert-icon"></i>
                <strong>Password does not match!</strong>
              </div>
              <div class="alertMessage alert-error">
                <span class="close" id="close-alert-error">×</span>
                <i class="fas fa-exclamation-circle alert-icon"></i>
                <strong>Error Occured!</strong>
              </div>
              <div class="edit-container">
                <div class="user-details">
                  <h5>Password</h5>
                  <button class="editprofile-btn" id="removeReadOnly2">Change</button>
                </div>
                <form action="javascript:changePassword();" class="edit-form">
                  <div class="form-container flex-column">
                    <div class="col-6 hide-txt5 hide-text-bg">
                      <label>Current Password</label>
                      <input type="password" id="password" placeholder="Password" readonly />
                    </div>
                    <div class="col-6 hide-txt6 hide-text-bg">
                      <label>New Password</label>
                      <input
                        type="password"
                        id="newPassword"
                        placeholder="New Password"
                        readonly
                        pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$"
                        title="Password must at least be 8 characters in length, and contain 1 uppercase character, 1 lowercase letter, and 1 number."
                        value=""
                      />
                    </div>
                    <div class="col-6 hide-txt7 hide-text-bg">
                      <label>Re-Enter Password</label>
                      <input type="password" id="rePassword" placeholder="Password" readonly />
                    </div>
                  </div>
                  <div class="flex-end-container">
                    <button type="submit" class="saveProfile-btn saveProfile-btn2" id="saveProfile-btn2">Save Changes</button>
                  </div>
                </form>
              </div>
            </div>
            <!--Booking Status Tab-->
            <h4 class="tab-accordion-title" rel="tabTwo">Booking Status</h4>
            <div id="tabTwo" class="tab-item">
              <div class="bookingstbl">
                <table class="ststbl">
                  <thead>
                    <tr>
                      <th class="thbs">Ref. No.</th>
                      <th class="thbs">Reserved Date</th>
                      <th class="thbs">Reservation Created</th>
                      <th class="thbs">Status</th>
                      <th class="thbs">Payment Status</th>
                      <th class="thbs">Action</th>
                    </tr>
                  </thead>
                  <tbody id="table_status">
                    <!-- <td class="tdbs">testing</td>
                    <td class="tdbs">testing</td>
                    <td class="tdbs">testing</td>
                    <td class="tdbs">testing</td>
                    <td><button type="button" class="btncancel" id="open-popup2-btn">CANCEL</button></td> -->
                    <!--Proceed with payment btn
                           <td class="btnprcd"><button type="button" style="background-color: #6b4f4f; color: #f9f2e7; border-radius: 5px; cursor: pointer;">Proceed to Payment</button></td>-->
                  </tbody>
                </table>
              </div>
            </div>

            <!--Upload Moment Tab-->
            <h4 class="tab-accordion-title" rel="tabThree">Upload a Moment</h4>
            <div id="tabThree" class="tab-item">
              <h5>Upload a Moment</h5>

              <div class="moment-form">
                <form action="javascript:uploadMoment()" class="moment-details">
                  <!-- ALERT -->
                  <div class="alertMessage alert1">
                    <span class="close" id="close-alert1">×</span>
                    <i class="fas fa-exclamation-circle alert-icon"></i>
                    <strong><span id="alertdesc"></span></strong>
                  </div>
                  <div class="alertMessage alertError">
                    <span class="close" id="close-alert">×</span>
                    <strong>Error Occured!</strong>
                  </div>
                  <div class="form-control checkbox-wrapper">
                    <input type="checkbox" class="checkbox-visible" name="checkbox" id="checkbox" value="checkbox one value" required />
                    <label for="checkbox">
                      <svg viewBox="0 0 100 100">
                        <path
                          class="path"
                          fill="none"
                          stroke="#000"
                          stroke-width="13"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-miterlimit="10"
                          d="M12.1 52.1l24.4 24.4 53-53"
                        />
                      </svg>
                      I agree to <a href="#" id="open-popup1-btn">Hulo Leisure Farm's Moment Policy </a>
                    </label>
                  </div>
                  <div class="moments-box">
                    <!-- <form class="moment-details"> -->
                    <div class="moment-desc">
                      <textarea id="moment-txt" name="moment-txt" placeholder="Write your moment here..."></textarea>
                    </div>
                    <div class="moment-btns">
                      <div class="moment-photo">
                        <div class="upload-container">
                          <div class="drop-area">
                            <i class="material-symbols-outlined">cloud_upload </i>
                            <h6 class="image-txt">Image size must be less than <span>2MB</span></h6>
                            <input type="file" accept="image/*" id="input-file" hidden />
                          </div>
                        </div>
                      </div>
                      <div class="mpost-btn bounce-in-on-hover">
                        <button class="post-btn" id="open-alert" onclick="checkboxValidation()">POST</button>
                      </div>
                    </div>
                    <!-- </form> -->
                  </div>
                </form>
              </div>
            </div>

            <!--Customer Satisfaction Tab-->
            <h4 class="tab-accordion-title" rel="tabFour">Customer Satisfaction</h4>
            <div id="tabFour" class="tab-item">
              <h5>Customer Satisfaction</h5>
              <!-- ALERT -->
              <div class="alertMessage alert2">
                <span class="close" id="close-alert2">×</span>
                <i class="fas fa-exclamation-circle alert-icon"></i>
                <strong>Customer Satisfaction was successfully sent!</strong>
              </div>
              <div class="line lupper"></div>
              <form action="javascript:sendCustomerS();">
                <div class="cs_icondiv">
                  <img src="/icons/sad.png" class="cs_icons sad" id="fbEmoji_sad" />
                  <img src="/icons/neutral.png" class="cs_icons neutral" id="fbEmoji_neutral" />
                  <img src="/icons/happy.png" class="cs_icons happy" id="fbEmoji_happy" />
                </div>
                <div class="line llower"></div>
                <div class="cs_text">
                  <p>Let us know what you like and where we can get better. Rate us and type your responses below.</p>
                  <div class="fb_tfield">
                    <textarea class="fb_text" id="fb_text" name="fb_text" placeholder="Write something.." style="height: 200px" required></textarea>
                  </div>
                </div>
                <div class="lastrow">
                  <p class="cs_text-hide" style="display: inline">Hide name</p>
                  <label class="switch">
                    <input type="checkbox" checked id="fb_hide" />
                    <span class="slider round"></span>
                  </label>

                  <div class="submitbtn">
                    <button type="submit" class="fb_submit" id="open-alert2" style="display: inline">Submit</button>
                  </div>
                </div>
              </form>
            </div>
            <!--Logout Tab-->
            <!-- <h4 class="tab-accordion-title" rel="tabFive">Logout</h4>
            <div id="tabFive" class="tab-item">
              <h5>Tab 5 content</h5>
              <p>
              </p>
            </div> -->
          </div>
        </div>
      </div>
    </section>

    <!-- START OF POPUP -->
    <div class="popup popup1 center">
      <div class="description">
        <h2 style="text-align: center"><b>MOMENTS POLICY</b></h2>
        <br />
        A guest will only be allowed to upload up to 1 moment per booking.
        <br />
        Only image less than 2mb can be uploaded.
        <br />
        Only image file types are allowed (ex: jpg and png).
      </div>
      <div class="dismiss-btn">
        <button id="dismiss-popup1-btn">Close</button>
      </div>
    </div>

    <div class="popup popup2 center popup-short">
      <div class="popup-title">Cancel Reservation</div>
      <div class="description">Are you sure you want to cancel the reservation?</div>
      <div class="dismiss-btn">
        <button id="confirm-popup2-btn" onclick="cancelBooking()">Yes</button>
        <button id="dismiss-popup2-btn">No</button>
      </div>
    </div>

    <div class="popup popupremarks center popup-short">
      <div class="popup-title">Remarks</div>
      <div class="description"><span id="remarksdesc"></span></div>
      <div class="dismiss-btn">
        <button id="dismiss-popupremarks-btn">Close</button>
      </div>
    </div>

    <div class="popup popup3 center popup-short">
      <div class="popup-title">Upload Moment</div>
      <div class="description">Please agree to the Moment Policy!</div>
      <div class="dismiss-btn">
        <button id="dismiss-popup3-btn">Close</button>
      </div>
    </div>

    <!-- END OF POPUP -->

    <!--Footer-->
    <section class="display-footer">
      <div id="footer-placeholder"></div>
    </section>
    <script src="app.js"></script>

    <script>
      const checkboxValidation = () => {
        if (document.getElementById("checkbox").checked) {
        } else {
          document.getElementsByClassName("popup3")[0].classList.add("active");
        }
      };

      const uploadMoment = () => {
        const file = document.querySelector("#input-file");
        console.log(file.files[0]);
        const description = document.querySelector("#moment-txt");
        console.log(description.value);
        let fd = new FormData();
        fd.append("file", file.files[0]);
        fd.append("description", description.value);
        let options = {
          method: "POST",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("access_token"),
          },
          body: fd,
        };

        fetch("https://ulayaw-app.azurewebsites.net/moment/upload", options)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            document.getElementById("alertdesc").innerText = data.message;
            document.getElementsByClassName("alert1")[0].style.display = "block";
            // clear input
            document.getElementById("moment-txt").value = "";
          });
      };

      const setValues = async () => {
        let user = await getUser(localStorage.getItem("user_id"));
        console.log(user);
        let nameTag = document.getElementById("nameTag");
        nameTag.innerHTML = "WELCOME, " + user.firstName;
        let firstname = document.getElementById("firstname");
        firstname.value = user.firstName;
        let lastname = document.getElementById("lastname");
        lastname.value = user.lastName;
        let contact = document.getElementById("contact");
        contact.value = user.contact;
        let email = document.getElementById("email");
        email.value = user.email;

        let desc = document.getElementById("fb_text");
        desc.value = user.feedback.description;
        let isAn = document.getElementById("fb_hide");
        isAn.checked = user.feedback.isAnonymous;

        if (user.feedback.rating === 1) {
          let sad = document.getElementById("fbEmoji_sad");
          sad.classList.add("active");
        } else if (user.feedback.rating === 2) {
          let neutral = document.getElementById("fbEmoji_neutral");
          neutral.classList.add("active");
        } else if (user.feedback.rating === 3) {
          let happy = document.getElementById("fbEmoji_happy");
          happy.classList.add("active");
        }
      };

      setValues();
      //Import Navbar
      $(function () {
        $("#nav-placeholder").load("navbar.html");
      });

      //Import Footer
      $(function () {
        $("#footer-placeholder").load("footer.html");
      });

      //Tabs
      jQuery(".tab-item").hide();
      jQuery(".tab-item:first").show();

      jQuery("ul.tabs li").click(function () {
        jQuery(".tab-item").hide();
        var activeTab = $(this).attr("rel");
        jQuery("#" + activeTab).fadeIn();

        jQuery("ul.tabs li").removeClass("tab-active");
        jQuery(this).addClass("tab-active");

        jQuery(".tab-accordion-title").removeClass("tab-accordion-active");
        jQuery(".tab-accordion-title[rel^='" + activeTab + "']").addClass("tab-accordion-active");
      });

      jQuery(".tab-accordion-title").click(function () {
        jQuery(".tab-item").hide();
        var d_activeTab = $(this).attr("rel");
        jQuery("#" + d_activeTab).fadeIn();

        jQuery(".tab-accordion-title").removeClass("tab-accordion-active");
        jQuery(this).addClass("tab-accordion-active");

        jQuery("ul.tabs li").removeClass("tab-active");
        jQuery("ul.tabs li[rel^='" + d_activeTab + "']").addClass("tab-active");
      });

      // Alert
      // document.getElementById("open-alert").addEventListener("click", function () {
      //   document.getElementsByClassName("alert")[0].style.display = "block";
      // });

      document.getElementById("close-alert1").addEventListener("click", function () {
        document.getElementsByClassName("alert1")[0].style.display = "none";
      });

      const sendCustomerS = () => {
        let sad = document.getElementById("fbEmoji_sad");
        let neutral = document.getElementById("fbEmoji_neutral");
        let happy = document.getElementById("fbEmoji_happy");
        if (sad.classList.contains("active")) {
          rating = 1;
        } else if (neutral.classList.contains("active")) {
          rating = 2;
        } else if (happy.classList.contains("active")) {
          rating = 3;
        } else {
          rating = 0;
        }
        let desc = document.getElementById("fb_text").value;
        let isAn = document.getElementById("fb_hide").checked ? true : false;
        // get values
        const data = {
          feedback: {
            rating: rating,
            description: desc,
            isAnonymous: isAn,
          },
        };
        let options = {
          method: "PUT",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
          body: JSON.stringify(data),
        };

        fetch("https://ulayaw-app.azurewebsites.net/user/updateOne/" + localStorage.getItem("user_id"), options)
          .then((response) => response.json())
          .then((data) => {
            if (data.payload) {
              setValues();
              document.getElementsByClassName("alert2")[0].style.display = "block";
              document.getElementById("fb_text").value = "";
            }
          });
      };

      document.getElementById("close-alert2").addEventListener("click", function () {
        document.getElementsByClassName("alert2")[0].style.display = "none";
      });

      // function openAlert() {
      // var openA = document.getElementById("open-alert");
      //   openA.classList.toggle("show");
      // });

      // Remove readOnly
      document.getElementById("removeReadOnly").addEventListener("click", function () {
        document.getElementById("firstname").toggleAttribute("readonly");
        document.getElementById("contact").toggleAttribute("readonly");
        document.getElementById("email").toggleAttribute("readonly");
        document.getElementById("lastname").toggleAttribute("readonly");
        document.getElementsByClassName("hide-txt1")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt2")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt3")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt4")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("saveProfile-btn")[0].classList.toggle("showProfile-btn");
      });

      document.getElementById("removeReadOnly2").addEventListener("click", function () {
        document.getElementById("password").toggleAttribute("readonly");
        document.getElementById("rePassword").toggleAttribute("readonly");
        document.getElementById("newPassword").toggleAttribute("readonly");
        document.getElementsByClassName("hide-txt5")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt6")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt7")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("saveProfile-btn2")[0].classList.toggle("showProfile-btn");
      });

      const saveProfile = () => {
        // e.preventDefault();
        let firstname = document.getElementById("firstname");
        firstname.toggleAttribute("readonly");
        let lastname = document.getElementById("lastname");
        lastname.toggleAttribute("readonly");
        let contact = document.getElementById("contact");
        contact.toggleAttribute("readonly");
        let email = document.getElementById("email");
        email.toggleAttribute("readonly");
        document.getElementsByClassName("hide-txt1")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt2")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt3")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt4")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("saveProfile-btn")[0].classList.toggle("showProfile-btn");
        // update user
        const data = {
          firstName: firstname.value,
          lastName: lastname.value,
          contact: contact.value,
          //  email: email.value,
        };
        let options = {
          method: "PUT",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
          body: JSON.stringify(data),
        };

        fetch("https://ulayaw-app.azurewebsites.net/user/updateOne/" + localStorage.getItem("user_id"), options)
          .then((response) => response.json())
          .then((data) => {
            if (data.payload) {
              setValues();
              document.getElementsByClassName("alert3")[0].style.display = "block";

              document.getElementById("close-alert3").addEventListener("click", function () {
                document.getElementsByClassName("alert3")[0].style.display = "none";
              });
            }
          });
      };

      const changePassword = () => {
        let oldPass = document.getElementById("password").value;
        let newPass = document.getElementById("newPassword").value;
        let rePass = document.getElementById("rePassword").value;
        const data = {
          oldPassword: oldPass,
          newPassword: newPass,
        };
        let options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
            Authorization: "Bearer " + localStorage.getItem("access_token"),
          },
          body: JSON.stringify(data),
        };

        if (newPass === rePass) {
          fetch("https://ulayaw-app.azurewebsites.net/auth/changePassword", options)
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              if (data.key === "PASSUPDATED") {
                document.getElementsByClassName("alert4")[0].style.display = "block";

                document.getElementById("close-alert4").addEventListener("click", function () {
                  document.getElementsByClassName("alert4")[0].style.display = "none";
                });
              } else {
                document.getElementsByClassName("alert-error")[0].style.display = "block";

                document.getElementById("close-alert-error").addEventListener("click", function () {
                  document.getElementsByClassName("alert-error")[0].style.display = "none";
                });
              }
            });
        } else {
          setTimeout(() => {
            document.getElementsByClassName("alert5")[0].style.display = "block";
          }, 5000);

          document.getElementById("close-alert5").addEventListener("click", function () {
            document.getElementsByClassName("alert5")[0].style.display = "none";
          });
        }
      };

      const bookingStatus = () => {
        let id = localStorage.getItem("user_id");
        console.log(id);

        let options = {
          method: "GET",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
            Authorization: "Bearer " + localStorage.getItem("access_token"),
          },
        };
        // console.log(`https://ulayaw-app.azurewebsites.net/booking/get?userId=${id}`);
        fetch(`https://ulayaw-app.azurewebsites.net/booking/get?userId=${id}`, options)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // console.log(data.payload.length);
            data.payload = data.payload.sort((a, b) => {
              return new Date(b.dateBooked) - new Date(a.dateBooked);
            });
            if (data.payload.length > 0) {
              var data1 = "";
              for (i = 0; i < data.payload.length; i++) {
                // if (data.payload[i].status == "Pending" || data.payload[i].status == "Accepted") {
                data1 += "<tr>";
                data1 += "<td class='tdbs'>" + data.payload[i]._id + "</td>";
                data1 += "<td class='tdbs'>" + convertDate(data.payload[i].startDate) + " to " + convertDate(data.payload[i].endDate) + "</td>";
                data1 += "<td class='tdbs'>" + convertDate(data.payload[i].dateBooked) + "</td>";
                data1 += "<td class='tdbs'>" + data.payload[i].status + "</td>";
                data1 += "<td class='tdbs ispaid'>" + convertPaymentStatus(data.payload[i].isPaid) + "</td>";
                if (data.payload[i].status === "Accepted") {
                  if (data.payload[i].isPaid === true) {
                    data1 +=
                      "<td class='tdbs1'><button type='button' class='" + data.payload[i]._id + " btnreceipt'>View Proof of payment</button></td>";
                  } else {
                    data1 +=
                      "<td><button class='" +
                      data.payload[i]._id +
                      " btnprcd' type='button' style='background-color: #6b4f4f; color: #f9f2e7; border-radius: 5px; cursor: pointer;'>Proceed to Payment</button></td>";
                  }
                } else if (data.payload[i].status === "Rejected") {
                  data1 +=
                    "<td><button type='button' class='" + data.payload[i]._id + " btnremarks " + data.payload[i].remarks + "'>Remarks</button></td>";
                  data1 += "<td><input type='text' id='hide-input' value='" + data.payload[i].remarks + "' disabled></td>";
                } else if (data.payload[i].status === "Pending") {
                  data1 += "<td><button type='button' class='" + data.payload[i]._id + " btncancel'>CANCEL</button></td>";
                } else {
                  data1 += "<td class='tdbs'></td>";
                }
                data1 += "</tr>";
                // }
              }
              $("#table_status").html(data1);
            }
          });
      };
      bookingStatus();

      const saveBookingId = (e) => {
        // console.log(e);
        if (e.target.classList[1] === "btncancel") {
          let bookingId = e.target.classList[0];
          console.log(bookingId);
          sessionStorage.setItem("booking_id", bookingId);
          document.getElementsByClassName("popup2")[0].classList.add("active");
        }
        if (e.target.classList[1] === "btnprcd") {
          let bookingId = e.target.classList[0];
          console.log(bookingId);
          sessionStorage.setItem("booking_id", bookingId);
          window.location.replace("/paymentsummary.html");
        }
        if (e.target.classList[1] === "btnremarks") {
          // let bookingId = e.target.classList[0];
          // console.log(bookingId);
          // sessionStorage.setItem("booking_id", bookingId);
          // console.log(e.target.classList[2]);
          document.getElementById("remarksdesc").innerHTML = document.getElementById("hide-input").value;
          // document.getElementById("remarksdesc").innerHTML = e.target.classList[2];
          document.getElementsByClassName("popupremarks")[0].classList.add("active");
        }
        if (e.target.classList[1] === "btnreceipt") {
          let bookingId = e.target.classList[0];
          console.log(bookingId);
          // sessionStorage.setItem("booking_id", bookingId);
          window.location.replace(`/c-receipt.html?id=${bookingId}`);
        }
      };
      document.body.addEventListener("click", saveBookingId);

      const cancelBooking = () => {
        const data = {
          status: "Cancelled",
        };
        let options = {
          method: "PUT",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
            Authorization: "Bearer " + localStorage.getItem("access_token"),
          },
          body: JSON.stringify(data),
        };

        fetch("https://ulayaw-app.azurewebsites.net/booking/update/" + sessionStorage.getItem("booking_id"), options)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
          });
        // location.reload();
      };

      document.getElementById("saveProfile-btn2").addEventListener("click", function () {
        document.getElementById("password").toggleAttribute("readonly");
        document.getElementById("rePassword").toggleAttribute("readonly");
        document.getElementById("newPassword").toggleAttribute("readonly");
        document.getElementsByClassName("hide-txt5")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt6")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("hide-txt7")[0].classList.toggle("hide-text-bg");
        document.getElementsByClassName("saveProfile-btn2")[0].classList.toggle("showProfile-btn");
      });

      // Popup Button
      document.getElementById("open-popup1-btn").addEventListener("click", function () {
        document.getElementsByClassName("popup1")[0].classList.add("active");
      });

      document.getElementById("dismiss-popup1-btn").addEventListener("click", function () {
        document.getElementsByClassName("popup1")[0].classList.remove("active");
      });

      // document.getElementById("open-popup2-btn").addEventListener("click", function () {
      //   document.getElementsByClassName("popup2")[0].classList.add("active");
      // });

      document.getElementById("confirm-popup2-btn").addEventListener("click", function () {
        document.getElementsByClassName("popup2")[0].classList.remove("active");
      });

      document.getElementById("dismiss-popup2-btn").addEventListener("click", function () {
        document.getElementsByClassName("popup2")[0].classList.remove("active");
      });

      document.getElementById("dismiss-popup3-btn").addEventListener("click", function () {
        document.getElementsByClassName("popup3")[0].classList.remove("active");
      });

      document.getElementById("dismiss-popupremarks-btn").addEventListener("click", function () {
        document.getElementsByClassName("popupremarks")[0].classList.remove("active");
      });

      /** emoji feedback js **/

      // $('#fbEmoji_sad').click(function() {
      // $('#fbEmoji_sad').css({
      // 'cursor' : 'pointer',
      // 'transform' : 'scale(1.1)',
      // 'filter': 'grayscale(0%)'
      // });
      // });

      // $('#fbEmoji_neutral').click(function() {
      // $('#fbEmoji_neutral').css({
      // 'cursor' : 'pointer',
      // 'transform' : 'scale(1.1)',
      // 'filter': 'grayscale(0%)'
      // });
      // });

      // $('#fbEmoji_happy').click(function() {
      // $('#fbEmoji_happy').css({
      // 'cursor' : 'pointer',
      // 'transform' : 'scale(1.1)',
      // 'filter': 'grayscale(0%)'
      // });
      // });

      const sad = document.getElementById("fbEmoji_sad");
      const neutral = document.getElementById("fbEmoji_neutral");
      const happy = document.getElementById("fbEmoji_happy");
      sad.addEventListener("click", (evt) => {
        if (evt.target.classList.contains("active")) {
          evt.target.classList.remove("active");
        } else {
          evt.target.classList.add("active");

          happy.classList.remove("active");
          neutral.classList.remove("active");
        }
      });

      neutral.addEventListener("click", (evt) => {
        if (evt.target.classList.contains("active")) {
          evt.target.classList.remove("active");
        } else {
          evt.target.classList.add("active");

          sad.classList.remove("active");
          happy.classList.remove("active");
        }
      });

      happy.addEventListener("click", (evt) => {
        if (evt.target.classList.contains("active")) {
          evt.target.classList.remove("active");
        } else {
          evt.target.classList.add("active");

          sad.classList.remove("active");
          neutral.classList.remove("active");
        }
      });

      //upload pic
      const dropArea = document.querySelector(".drop-area");
      const inputFile = document.getElementById("input-file");

      dropArea.addEventListener("click", function () {
        inputFile.click();
      });

      inputFile.addEventListener("change", function () {
        const file = this.files[0];

        if (file.type.startsWith("image/")) {
          if (file.size < 2000000) {
            create_thumbnail(file);
          } else {
            alert("Image size must be less than 2MB");
          }
        } else {
          alert("Must be image");
        }
      });

      dropArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        this.style.borderStyle = "solid";

        const h3 = this.querySelector("h3");
        h3.textContent = "Release here to upload image";
      });

      dropArea.addEventListener("drop", function (e) {
        e.preventDefault();

        inputFile.files = e.dataTransfer.files;
        const file = e.dataTransfer.files[0];

        if (file.type.startsWith("image/")) {
          if (file.size < 2000000) {
            create_thumbnail(file);
          } else {
            alert("Image size must be less than 2MB");
          }
        } else {
          alert("Must be image");
        }
      });

      const command = ["dragleave", "dragend"];

      command.forEach((item) => {
        dropArea.addEventListener(item, function () {
          this.style.borderStyle = "dashed";

          const h3 = this.querySelector("h3");
          h3.textContent = "Drag and drop or click here to select image";
        });
      });

      function create_thumbnail(file) {
        const img = document.querySelectorAll(".thumbnail");
        const imgName = document.querySelectorAll(".img-name");
        img.forEach((item) => item.remove());
        imgName.forEach((item) => item.remove());

        const reader = new FileReader();
        reader.onload = () => {
          const url = reader.result;
          const img = document.createElement("img");
          img.src = url;
          img.className = "thumbnail";
          const span = document.createElement("span");
          span.className = "img-name";
          span.textContent = file.name;
          dropArea.appendChild(img);
          dropArea.appendChild(span);
          dropArea.style.borderColor = "transparent";
        };
        reader.readAsDataURL(file);
      }

      var btnUpload = $("#upload_file"),
        btnOuter = $(".button_outer");
      btnUpload.on("change", function (e) {
        var ext = btnUpload.val().split(".").pop().toLowerCase();
        if ($.inArray(ext, ["gif", "png", "jpg", "jpeg"]) == -1) {
          $(".error_msg").text("Not an Image...");
        } else {
          $(".error_msg").text("");
          btnOuter.addClass("file_uploading");
          setTimeout(function () {
            btnOuter.addClass("file_uploaded");
          }, 3000);
          var uploadedFile = URL.createObjectURL(e.target.files[0]);
          setTimeout(function () {
            $("#uploaded_view")
              .append('<img src="' + uploadedFile + '" />')
              .addClass("show");
          }, 3500);
        }
      });
      $(".file_remove").on("click", function (e) {
        $("#uploaded_view").removeClass("show");
        $("#uploaded_view").find("img").remove();
        btnOuter.removeClass("file_uploading");
        btnOuter.removeClass("file_uploaded");
      });

      const logout = () => {
        localStorage.clear();
        window.location.replace("/login-reg.html");
      };
    </script>
  </body>
</html>
