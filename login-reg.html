<!DOCTYPE html>
<!-- === Coding by CodingLab | www.codinglabweb.com === -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Abril Fatface" rel="stylesheet" />
    <link rel="stylesheet" href="/css/utilities.css" />

    <title>Hulo Leisure Farm</title>
  </head>
  <body>
    <!--Navbar-->
    <section class="display-navbar">
      <div id="nav-placeholder"></div>
    </section>

    <section class="log-body">
      <div class="log-container">
        <div class="log-forms">
          <div class="logform r-login">
            <span class="log-title">Login</span>

            <form onsubmit="event.preventDefault(); loginUser();">
              <div class="log-input-field">
                <input class="log-input" id="loginEmail" type="text" placeholder="Enter your email" required />
                <i class="uil uil-envelope icon"></i>
              </div>
              <div class="log-input-field">
                <input class="log-input" id="loginPw" type="password" class="password" placeholder="Enter your password" required />
                <i class="uil uil-lock icon"></i>
              </div>

              <div class="log-checkbox-text">
                <a href="forgotpw-1.html" class="text">Forgot password?</a>
              </div>

              <div class="log-input-field button">
                <input class="log-input-btn" type="submit"  type="button" value="Login" />
              </div>
              <div class="log-checkbox-text">
                <ul class="text noaccount">
                  No account yet?
                </ul>
                <a href="#" class="text signup-link">Register here.</a>
              </div>
            </form>
          </div>

          <!-- Registration Form -->
          <div class="logform r-signup">
            <span class="log-title">Registration</span>

            <form action="#">
              <div class="log-input-field">
                <input id="firstName" class="log-input" type="text" placeholder="Enter your first name" required value="" />
                <i class="uil uil-user"></i>
              </div>
              <div class="log-input-field">
                <input id="lastName" class="log-input" type="text" placeholder="Enter your last name" required value="" />
                <i class="uil uil-user"></i>
              </div>
              <div class="log-input-field">
                <input id="email" class="log-input" type="text" placeholder="Enter your email" required value="" />
                <i class="uil uil-envelope icon"></i>
              </div>
              <div class="log-input-field">
                <input id="contact" class="log-input" type="number" placeholder="Enter your contact number" required value="" />
                <i class="uil uil-user"></i>
              </div>
              <div class="log-input-field">
                <input id="password" class="log-input" type="password" class="password" placeholder="Create a password" required value="" />
                <i class="uil uil-lock icon"></i>
              </div>
              <div class="log-input-field">
                <input class="log-input" type="password" class="password" placeholder="Confirm a password" required value="" />
                <i class="uil uil-lock icon"></i>
              </div>

              <div class="log-checkbox-text">
                <div class="log-checkbox-content">
                  <input class="logcheck" type="checkbox" id="termCon" required />
                  <label for="termCon" class="text">I agree to the <a href="#" id="open-popup-btn-1">Terms and Conditions</a></label>
                </div>
              </div>

              <div class="log-input-field button">
                <input onclick="signup()" class="log-input-btn" type="button" value="Register" />
              </div>

              <div class="log-r-haveacc">
                <ul class="text haveaccount">
                  Already have an account?
                </ul>
                <a href="#" class="text login-link">Login here.</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- START OF POPUP -->
    <div class="popup popup1 center">
      <div class="description">
        <h2 style="text-align: center"><b>Terms and Conditions</b></h2>
        <br />
        1. Just kindly be reminded that the 20% reservation fee to block the date is non-refundable. If you wish to rebook to other date/s from your
        booking, kindly advice us atleast 2 weeks before.
        <br />
        2. For weekend reservation, you may need to provide another reservation fee for another date.
        <br />
      </div>
      <div class="dismiss-btn">
        <button id="dismiss-popup-btn-1">Close</button>
      </div>
    </div>

    <!-- END OF POPUP -->

    <script>
      const navigate = () =>{
        if(localStorage.getItem('access_token')){
        if(localStorage.getItem('user_role') === 'Guest'){
          window.location.replace('/c-profile.html');
        }else
        if(localStorage.getItem('user_role') === 'Admin'){
          window.location.replace('/a-profile.html');
        }
      }
      }
      navigate();
      //Import Navbar
      $(function () {
        $("#nav-placeholder").load("navbar.html");
      });

      const container = document.querySelector(".log-container");
      const container1 = document.querySelector(".container1"),
        pwShowHide = document.querySelectorAll(".showHidePw"),
        pwFields = document.querySelectorAll(".password"),
        signUp = document.querySelector(".signup-link"),
        login = document.querySelector(".login-link");

      // js code to appear signup and login form
      signUp.addEventListener("click", () => {
        container.classList.add("active");
      });
      login.addEventListener("click", () => {
        container.classList.remove("active");
      });

      // Popup Button
      document.getElementById("open-popup-btn-1").addEventListener("click", function () {
        document.getElementsByClassName("popup1")[0].classList.add("active");
      });

      document.getElementById("dismiss-popup-btn-1").addEventListener("click", function () {
        document.getElementsByClassName("popup1")[0].classList.remove("active");
      });

      const loginUser = () =>{
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPw").value;

        let loginData ={
          email: email,
          password: password
        }

        let options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
          body: JSON.stringify(loginData),
        };

        fetch("http://ulayaw-backend.herokuapp.com/auth/login", options)
          .then((response) => response.json())
          .then((data) => {
            if(data.token){
              localStorage.setItem('access_token', data.token);
              localStorage.setItem('user_role', data.userRole);
              navigate();
            }else
            if(data.key === 'USERNOEXIST'){

            }
            console.log(data);
          });
      }

      const signup = () => {
        const firstName = document.getElementById("firstName").value;
        const lastName = document.getElementById("lastName").value;
        const email = document.getElementById("email").value;
        const contact = document.getElementById("contact").value;
        const password = document.getElementById("password").value;
        let signupData = {
          email: email,
          password: password,
          firstName: firstName,
          lastName: lastName,
          contact: contact,
          role: "Guest",
        };
        console.log(signupData);
        let options = {
          method: "PUT",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
          body: JSON.stringify(signupData),
        };
        fetch("http://ulayaw-backend.herokuapp.com/auth/signup", options)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // write action code here
            // if  success
            // if fail
          });
      }
    </script>
  </body>
</html>
